import{d as e,r as a,B as l,e as s,g as u,k as o,n as t,s as n,x as d,p as r,i,j as c,y as v,W as p,aI as m,aC as f,F as y,q as b,I as g,U as h,Z as _,a0 as w,w as k,z as I,au as x,K as C,J as V,Q as U}from"./vendor.b6c71576.js";import{ag as z,m as B,B as F,b as j,w as N,ah as P,R as S,c as q,u as M,ai as T,a as G,aj as A}from"./index.0564e520.js";const D=d();r("data-v-0e729190");const J={class:"big-file-uploader"},K={class:"file-info"},Q={class:"flex ac"},R={class:"progress-info"},W={key:0},Z=n(" 上传失败 "),E=n("重试"),H={key:1},L={class:"info"},O={class:"progress-wrap"},X={class:"info"},Y={class:"progress-wrap"};var $,ee;i(),(ee=$||($={}))[ee.Pause=0]="Pause",ee[ee.Uploading=1]="Uploading",ee[ee.Pending=2]="Pending";var ae=e({expose:[],props:{courseId:{type:[Number,null],required:!1},id:{type:Number,required:!0}},emits:["finish"],setup(e,{emit:d}){const r=e,i=a(2),v=l((()=>{switch(i.value){case 0:return"恢复";case 1:return"暂停";case 2:return"开始上传"}})),p=()=>{2===i.value?(I.value&&I.value(),i.value=1):0===i.value?(i.value=1,w()):(i.value=0,_())},m=3*Math.pow(1024,3);let f=a();const[y,b,g,h,_,w]=z(r.id,r.courseId||void 0,(e=>{d("finish",e)})),k=l((()=>b.value>=1));let I=a();const x=B((e=>(f.value=e,i.value=2,[e.size<m,"文件上传限制为 3GB，你可以: 出资加大服务器存储容量"])),(async e=>{const a=await h(e);I.value=a}));return(e,a)=>{var l,d;return c(),s("div",J,[u("h3",{class:"p",ref:x},"拖动到此或者点击上传文件",512),u("ul",K,[u("li",null,"文件名: "+o(null==(l=t(f))?void 0:l.name),1),u("li",null,"总大小: "+o(t(F)(null==(d=t(f))?void 0:d.size)),1)]),u("div",Q,[u(t(j),{onClick:p,disabled:!t(k)},{default:D((()=>[n(o(t(v)),1)])),_:1},8,["disabled"]),u("span",R,["上传失败"===t(y)?(c(),s("span",W,[Z,u(t(j),{onClick:a[1]||(a[1]=()=>{t(I)&&t(I)()}),type:"broke"},{default:D((()=>[E])),_:1})])):(c(),s("span",H,o(t(y)),1))])]),u("span",L,"准备进度: "+o(Math.floor(100*t(b))+"%"),1),u("div",O,[u("div",{class:"progress-bar",style:{width:(100*t(b)).toFixed(2)+"%"}},null,4)]),u("span",X,"上传进度: "+o(Math.floor(100*t(g))+"%"),1),u("div",Y,[u("div",{class:"progress-bar",style:{width:(100*t(g)).toFixed(2)+"%"}},null,4)])])}}});ae.__scopeId="data-v-0e729190";const le=d();r("data-v-706be548");const se={class:"announce"},ue=u("div",{class:"font16"},"公告标题",-1),oe=u("div",{class:"font16"},"公告内容",-1),te=u("div",{class:"font16"},"公告对象",-1),ne=n("全部"),de=n("上传文件（可选）"),re=n("发布"),ie=n("添加附件"),ce=n("删除公告"),ve=u("h5",{class:"lighter"},[u("div",{style:{padding:"20px","background-color":"rgb(255, 228, 228)",color:"red","border-radius":"5px"}},"不要上传大于3G的文件")],-1),pe={key:1,style:{height:"100%"}};i();var me=e({expose:[],setup(e){const d=M(),r=a(""),i=a(""),z=a(null),B=a(),F=a(null),j=async()=>{const e=await((e,a,l,s,u)=>{const o=new FormData;return o.set("adminId",e),!P(a)&&o.set("courseId",a.toString()),o.set("title",l),o.set("content",s),u&&o.set("file",u),N.post("/announce/addAnnounce",o)})(d.state.user.userInfo.adminId,z.value,r.value,i.value);return e.error_code===G.Success&&(F.value=e.data,Z(),!0)},D=async()=>{await j()&&B.value.open()},J=l((()=>[r,i].every((e=>e.value)))),K=async()=>{await j()&&I({message:"发布成功"})},Q=()=>{B.value.close(),I({message:"上传文件成功"})},R=a(1),W=a(),Z=async()=>{if(!z.value)return;const e=await A(R.value,z.value,S);e.error_code===G.Success&&(W.value=e.data)},E=e=>{R.value=e};v((()=>{var e;z.value=(null==(e=d.state.user.allCourses[0])?void 0:e.courseId)||null})),v((()=>{Z()}));const H=a(0);return(e,a)=>{var l,v;const j=C("el-table-column"),N=C("el-table"),P=V("loading");return c(),s(y,null,[u("div",se,[ue,u(t(p),{placeholder:"公告标题",modelValue:r.value,"onUpdate:modelValue":a[1]||(a[1]=e=>r.value=e)},null,8,["modelValue"]),oe,u(t(p),{placeholder:"公告内容",rows:2,type:"textarea",modelValue:i.value,"onUpdate:modelValue":a[2]||(a[2]=e=>i.value=e)},null,8,["modelValue"]),te,u(t(m),{modelValue:z.value,"onUpdate:modelValue":a[3]||(a[3]=e=>z.value=e)},{default:le((()=>[u(t(f),{label:null},{default:le((()=>[ne])),_:1}),(c(!0),s(y,null,b(t(d).state.user.allCourses,(e=>(c(),s(t(f),{label:e.courseId,key:e.courseId},{default:le((()=>[n(o(e.courseName),1)])),_:2},1032,["label"])))),128))])),_:1},8,["modelValue"]),u(t(g)),u(t(h),{onClick:D,type:"primary"},{default:le((()=>[de])),_:1}),u(t(h),{onClick:K,disabled:!t(J),type:"primary"},{default:le((()=>[re])),_:1},8,["disabled"])]),u(t(g)),u("div",null,[u(t(_),{modelValue:z.value,"onUpdate:modelValue":a[4]||(a[4]=e=>z.value=e),placeholder:"选择方向"},{default:le((()=>[(c(!0),s(y,null,b(t(d).state.user.allCourses,(e=>(c(),s(t(U),{key:e.id,label:e.courseName,value:e.courseId},null,8,["label","value"])))),128))])),_:1},8,["modelValue"]),u(N,{style:{width:"100%"},data:null==(l=W.value)?void 0:l.items},{default:le((()=>[u(j,{prop:"title",label:"标题"}),u(j,{prop:"addTime",label:"发布时间"}),u(j,{label:"操作"},{default:le((e=>[u(t(h),{type:"primary",onClick:a=>(async(e,a)=>{F.value=e,H.value=a,B.value.open()})(e.row.id,e.row.courseId)},{default:le((()=>[ie])),_:2},1032,["onClick"]),u(t(h),{type:"primary",onClick:a=>(async e=>{e&&x.confirm("确认删除吗",{cancelButtonText:"取消",confirmButtonText:"确定",callback:async a=>("confirm"===a&&(await T(e)).error_code===G.Success&&(I({message:"删除成功"}),Z()),!0)})})(e.row.id)},{default:le((()=>[ce])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"]),u(t(w),{onCurrentChange:E,"hide-on-single-page":"","page-size":t(S),total:null==(v=W.value)?void 0:v.total},null,8,["page-size","total"]),u(q,{ref:B,width:"80%"},{default:le((()=>[F.value?(c(),s(y,{key:0},[ve,u(ae,{onFinish:Q,id:F.value,"course-id":z.value},null,8,["id","course-id"])],64)):k((c(),s("div",pe,null,512)),[[P,!0]])])),_:1},512)])],64)}}});me.__scopeId="data-v-706be548";var fe=e({expose:[],setup:e=>(e,a)=>(c(),s("div",null,[u(me)]))});fe.__scopeId="data-v-5139fb7a";export default fe;
