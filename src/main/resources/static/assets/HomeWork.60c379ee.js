import{w as e,F as a,m as s,B as l,b as i,a as t,C as o,D as r,u,v as n,G as d,x as c,c as f}from"./index.0564e520.js";import{d as v,j as p,e as m,h as k,r as g,y,J as w,w as I,n as _,g as h,k as x,F as b,q as S,s as C,E as N,x as F,p as P,i as z,au as O,z as q,av as L,aw as T,ax as j,ay as B}from"./vendor.b6c71576.js";import{a as V,_ as W}from"./Fatal.f019e01c.js";var D=v({expose:[],props:{type:{type:[String,String,String,String],required:!1}},setup:e=>(a,s)=>(p(),m("span",{class:["tag",e.type||"normal"]},[k(a.$slots,"default",{},void 0,!0)],2))});D.__scopeId="data-v-1cdfb8c9";const E=F();P("data-v-40144fac");const G={class:"detail"},J={class:"title"},M=h("p",{class:"task-name"},"作业文件",-1),$={class:"flex ac list"},A=h("div",{class:"el-icon-download"},null,-1),H={class:"task-name"},K=C(" 提交记录 "),Q={key:0},R=h("span",{style:{"font-size":"14px"}},"无记录",-1),U={class:"flex ac list"},X={class:"file flex ac"},Y={class:"file-item"},Z={class:"file-desc"},ee={class:"progress-wrap"},ae=C("新提交");z();var se=v({expose:[],props:{userId:{type:String,required:!0},courseId:{type:Number,required:!0},info:{type:Object,required:!1}},setup(u){const n=u,d=g(null),c=g(a.Normal),f=async()=>{if(k.value=[],c.value=a.Pending,!n.info)return;const s=await(l=n.userId,i=n.info.id,e.get("/work/queryOneWork",{params:{userId:l,taskId:i}}));var l,i;if(s.error_code!==t.Success)return d.value=null,void(c.value=a.Fail);c.value=a.Success,d.value=s.data},v=s=>{s&&d.value&&O.confirm("删除不可逆，确认删除吗?",{cancelButtonText:"取消",confirmButtonText:"确定",async callback(l){if("confirm"===l){c.value=a.Pending;(await((a,s)=>e.post("/work/deleteWork",{userId:a,id:s}))(n.userId,s)).error_code===t.Success?(d.value=null,f(),c.value=a.Success):c.value=a.Fail}}})},k=g([]),F=s((e=>{if(-1!==k.value.findIndex((a=>a.file.name===e.name&&a.file.size===e.size)))return[!1,"不能重复文件"];const a=e.size<15728640;return a&&k.value.push({file:e,progress:0}),[a,"作业不超过15M"]})),P=g(!1),z=async()=>{if(!k.value.length)return void q({message:"亲太心急了，等几秒后点击"});if(!n.info)return void q({message:"亲太心急了，等几秒后点击"});P.value=!0;let a=null;if(!d.value&&(a=await(s=n.info.id,l=n.courseId,i=n.userId,e.post("/work/addWork",{taskId:s,courseId:l,userId:i})),a.error_code!==t.Success))return;var s,l,i;const o=k.value.map((e=>r(a&&a.data.toString()||d.value.id,e.file,(a=>{e.progress=a.loaded/a.total})).then((e=>{if(e.error_code!==t.Success)throw e;return e}))));try{await Promise.all(o),await f()}finally{P.value=!1}};return y((()=>{f()})),(e,s)=>{var r,g;const y=w("loading");return I((p(),m("div",G,[h("h4",J,x(u.info&&u.info.taskName||""),1),M,h("ul",$,[(p(!0),m(b,null,S(u.info&&u.info.taskFileVOList||[],((e,a)=>(p(),m("li",{class:"p file",key:a},[h("a",{class:"file-item",target:"_blank",href:e.filePath,download:e.fileName},[C(x(e.fileName)+" ",1),A],8,["href","download"])])))),128))]),h("p",H,[K,d.value?(p(),m("i",{key:0,class:"del-btn el-icon-close",onClick:s[1]||(s[1]=e=>{var a;return v((null==(a=d.value)?void 0:a.id)||null)})})):N("",!0)]),d.value?N("",!0):(p(),m("div",Q,[R])),h("ul",U,[(p(!0),m(b,null,S((null==(r=d.value)?void 0:r.workFileVOList)||[],(e=>(p(),m("li",X,[h("div",Y,[h("a",{href:e.filePath,download:e.fileName,target:"_blank"},x(e.fileName),9,["href","download"])]),h("i",{class:"del-btn el-icon-close",onClick:a=>(async e=>{e&&O.confirm("删除不可逆，确认删除吗?",{cancelButtonText:"取消",confirmButtonText:"确定",async callback(a){if("confirm"===a&&(await o(e.toString(),n.userId)).error_code===t.Success){const a=d.value.workFileVOList.findIndex((a=>a.id===e));d.value.workFileVOList.splice(a,1),f()}}})})(null==e?void 0:e.id)},null,8,["onClick"])])))),256))]),h("div",null,[h("div",{ref:F,class:"drop-file p"},"选择文件",512),h("ul",Z,[(p(!0),m(b,null,S(k.value,(e=>(p(),m("li",null,[C(x(e.file.name)+" "+x(_(l)(e.file.size))+" ",1),h("div",ee,[h("div",{class:"progress-bar",style:{width:100*e.progress+"%"}},null,4)])])))),256))]),h(_(i),{type:"broke",onClick:z,disabled:!!(null==(g=u.info)?void 0:g.isClosed)||P.value,loading:P.value},{default:E((()=>[ae])),_:1},8,["disabled","loading"])])],512)),[[y,!u.info||!u.courseId||!u.userId||c.value===_(a).Pending]])}}});se.__scopeId="data-v-40144fac";const le=F();P("data-v-397dfb78");const ie={class:"view-main"},te={class:"wrap"},oe={class:"info flex jc ac"},re={key:0,class:"list shade"},ue=C("可延迟提交"),ne={class:"time",style:{"margin-left":"5px"}},de={class:"collapse"},ce=h("p",null,"作业详情",-1),fe={class:"flex ac homework-list"},ve=h("div",{class:"el-icon-download"},null,-1),pe=C("提交");z();var me=v({expose:[],setup(s){const l=u(),o=g([]);y((()=>{o.value=l.state.user.allCourses.map((e=>({k:e.courseName,v:e.courseId})))}));const r=g(-1),v=g(""),k=g([]),w=g(0),I=g(a.Normal),F=async()=>{if(r.value<0)return;I.value=a.Pending;const s=await(l=r.value,e.get("/task/queryTasks",{params:{courseId:l}}));var l;s.error_code===t.Success?(k.value=s.data.taskPOList,w.value=s.data.total,I.value=a.Success):I.value=a.Fail};y((()=>{F()}));const P=(e,a)=>{r.value=e,v.value=a},z=g(null),O=g();return(e,s)=>(p(),m("div",ie,[h("div",te,[h("div",oe,[h(n,{class:"logo",courseName:v.value},null,8,["courseName"])]),h(_(d),{class:"shade",items:o.value,onChange:P},null,8,["items"]),k.value.length?(p(),m("div",re,[h(_(L),{accordion:""},{default:le((()=>[(p(!0),m(b,null,S(k.value,(e=>(p(),m(_(T),{key:e.id,class:["item",{done:e.isClosed}]},{title:le((()=>[h(_(j),{class:"header"},{default:le((()=>[h(_(B),{span:8},{default:le((()=>[C(x(e.taskName),1)])),_:2},1024),h(_(B),{span:8},{default:le((()=>[h(D,{style:{"font-size":"12px","margin-right":"5px"},type:e.isClosed?"error":"normal"},{default:le((()=>[C(x(e.isClosed?"已结束":"进行中"),1)])),_:2},1032,["type"]),e.commitLate?(p(),m(D,{key:0,style:{"font-size":"12px"},type:"success"},{default:le((()=>[ue])),_:1})):N("",!0)])),_:2},1024),h(_(B),{span:8},{default:le((()=>[h("span",ne,x(_(c)(e.addTime))+"发布, 截至时间"+x(e.closeTime),1)])),_:2},1024)])),_:2},1024)])),default:le((()=>[h("div",de,[ce,h("ul",fe,[(p(!0),m(b,null,S(e.taskFileVOList,((e,a)=>(p(),m("li",{class:"p file",key:a},[h("a",{href:e.filePath,download:e.fileName,target:"_blank"},[C(x(e.fileName)+" ",1),ve],8,["href","download"])])))),128))]),h(_(i),{onClick:a=>(e=>{var a;e.isClosed?q({message:"作业提交通道已关闭，下一次加油叭"}):l.state.user.allCourses[0]?(z.value=e,r.value=-1===r.value?l.state.user.allCourses[0].id:r.value,null==(a=O.value)||a.open()):q({message:"请重新登陆"})})(e)},{default:le((()=>[pe])),_:2},1032,["onClick"])])])),_:2},1032,["class"])))),128))])),_:1})])):I.value===_(a).Success?(p(),m(V,{key:1})):I.value===_(a).Fail?(p(),m(W,{key:2})):N("",!0),h(f,{ref:O,width:"80%"},{default:le((()=>[h(se,{userId:_(l).state.user.userInfo.userId||"",info:z.value||void 0,courseId:r.value},null,8,["userId","info","courseId"])])),_:1},512)])]))}});me.__scopeId="data-v-397dfb78";export default me;
