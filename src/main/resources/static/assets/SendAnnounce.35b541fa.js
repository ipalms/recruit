import{d as e,r as a,g as l,bn as s,Y as u,c as o,a as t,C as n,u as d,aj as r,j as i,k as c,w as v,p,e as f,o as b,aa as m,bo as y,H as g,aD as _,be as h,aE as w,a4 as k,a5 as C,bp as I,aF as x,bq as V,b4 as U,a8 as z,q as F,y as q,t as B,B as N,ak as P,br as S,b as j,az as M,a7 as T,bs as D,bt as G}from"./index.ea109c08.js";const A=v();p("data-v-0e729190");const E={class:"big-file-uploader"},H={class:"file-info"},Y={class:"flex ac"},J={class:"progress-info"},K={key:0},L=c(" 上传失败 "),O=c("重试"),Q={key:1},R={class:"info"},W={class:"progress-wrap"},X={class:"info"},Z={class:"progress-wrap"};var $,ee;f(),(ee=$||($={}))[ee.Pause=0]="Pause",ee[ee.Uploading=1]="Uploading",ee[ee.Pending=2]="Pending";var ae=e({expose:[],props:{courseId:{type:[Number,null],required:!1},id:{type:Number,required:!0}},emits:["finish"],setup(e,{emit:v}){const p=e,f=a(2),m=l((()=>{switch(f.value){case 0:return"恢复";case 1:return"暂停";case 2:return"开始上传"}})),y=()=>{2===f.value?(U.value&&U.value(),f.value=1):0===f.value?(f.value=1,x()):(f.value=0,I())},g=3*Math.pow(1024,3);let _=a();const[h,w,k,C,I,x]=s(p.id,p.courseId||void 0,(e=>{v("finish",e)})),V=l((()=>w.value>=1));let U=a();const z=u((e=>(_.value=e,f.value=2,[e.size<g,"文件上传限制为 3GB，你可以: 出资加大服务器存储容量"])),(async e=>{const a=await C(e);U.value=a}));return(e,a)=>{var l,s;return b(),o("div",E,[t("h3",{class:"p",ref:z},"拖动到此或者点击上传文件",512),t("ul",H,[t("li",null,"文件名: "+n(null==(l=d(_))?void 0:l.name),1),t("li",null,"总大小: "+n(d(r)(null==(s=d(_))?void 0:s.size)),1)]),t("div",Y,[t(d(i),{onClick:y,disabled:!d(V)},{default:A((()=>[c(n(d(m)),1)])),_:1},8,["disabled"]),t("span",J,["上传失败"===d(h)?(b(),o("span",K,[L,t(d(i),{onClick:a[1]||(a[1]=()=>{d(U)&&d(U)()}),type:"broke"},{default:A((()=>[O])),_:1})])):(b(),o("span",Q,n(d(h)),1))])]),t("span",R,"准备进度: "+n(Math.floor(100*d(w))+"%"),1),t("div",W,[t("div",{class:"progress-bar",style:{width:(100*d(w)).toFixed(2)+"%"}},null,4)]),t("span",X,"上传进度: "+n(Math.floor(100*d(k))+"%"),1),t("div",Z,[t("div",{class:"progress-bar",style:{width:(100*d(k)).toFixed(2)+"%"}},null,4)])])}}});ae.__scopeId="data-v-0e729190";const le=v();p("data-v-706be548");const se={class:"announce"},ue=t("div",{class:"font16"},"公告标题",-1),oe=t("div",{class:"font16"},"公告内容",-1),te=t("div",{class:"font16"},"公告对象",-1),ne=c("全部"),de=c("上传文件（可选）"),re=c("发布"),ie=c("添加附件"),ce=c("删除公告"),ve=t("h5",{class:"lighter"},[t("div",{style:{padding:"20px","background-color":"rgb(255, 228, 228)",color:"red","border-radius":"5px"}},"不要上传大于3G的文件")],-1),pe={key:1,style:{height:"100%"}};f();var fe=e({expose:[],setup(e){const s=B(),u=a(""),r=a(""),i=a(null),v=a(),p=a(null),f=async()=>{const e=await((e,a,l,s,u)=>{const o=new FormData;return o.set("adminId",e),!y(a)&&o.set("courseId",a.toString()),o.set("title",l),o.set("content",s),u&&o.set("file",u),m.post("/announce/addAnnounce",o)})(s.state.user.userInfo.adminId,i.value,u.value,r.value);return e.error_code===j.Success&&(p.value=e.data,L(),!0)},A=async()=>{await f()&&v.value.open()},E=l((()=>[u,r].every((e=>e.value)))),H=async()=>{await f()&&N({message:"发布成功"})},Y=()=>{v.value.close(),N({message:"上传文件成功"})},J=a(1),K=a(),L=async()=>{if(!i.value)return;const e=await G(J.value,i.value,z);e.error_code===j.Success&&(K.value=e.data)},O=e=>{J.value=e};g((()=>{var e;i.value=(null==(e=s.state.user.allCourses[0])?void 0:e.courseId)||null})),g((()=>{L()}));const Q=a(0);return(e,a)=>{var l,f;const m=M("el-table-column"),y=M("el-table"),g=T("loading");return b(),o(k,null,[t("div",se,[ue,t(d(_),{placeholder:"公告标题",modelValue:u.value,"onUpdate:modelValue":a[1]||(a[1]=e=>u.value=e)},null,8,["modelValue"]),oe,t(d(_),{placeholder:"公告内容",rows:2,type:"textarea",modelValue:r.value,"onUpdate:modelValue":a[2]||(a[2]=e=>r.value=e)},null,8,["modelValue"]),te,t(d(h),{modelValue:i.value,"onUpdate:modelValue":a[3]||(a[3]=e=>i.value=e)},{default:le((()=>[t(d(w),{label:null},{default:le((()=>[ne])),_:1}),(b(!0),o(k,null,C(d(s).state.user.allCourses,(e=>(b(),o(d(w),{label:e.courseId,key:e.courseId},{default:le((()=>[c(n(e.courseName),1)])),_:2},1032,["label"])))),128))])),_:1},8,["modelValue"]),t(d(I)),t(d(x),{onClick:A,type:"primary"},{default:le((()=>[de])),_:1}),t(d(x),{onClick:H,disabled:!d(E),type:"primary"},{default:le((()=>[re])),_:1},8,["disabled"])]),t(d(I)),t("div",null,[t(d(V),{modelValue:i.value,"onUpdate:modelValue":a[4]||(a[4]=e=>i.value=e),placeholder:"选择方向"},{default:le((()=>[(b(!0),o(k,null,C(d(s).state.user.allCourses,(e=>(b(),o(d(D),{key:e.id,label:e.courseName,value:e.courseId},null,8,["label","value"])))),128))])),_:1},8,["modelValue"]),t(y,{style:{width:"100%"},data:null==(l=K.value)?void 0:l.items},{default:le((()=>[t(m,{prop:"title",label:"标题"}),t(m,{prop:"addTime",label:"发布时间"}),t(m,{label:"操作"},{default:le((e=>[t(d(x),{type:"primary",onClick:a=>(async(e,a)=>{p.value=e,Q.value=a,v.value.open()})(e.row.id,e.row.courseId)},{default:le((()=>[ie])),_:2},1032,["onClick"]),t(d(x),{type:"primary",onClick:a=>(async e=>{e&&P.confirm("确认删除吗",{cancelButtonText:"取消",confirmButtonText:"确定",callback:async a=>("confirm"===a&&(await S(e)).error_code===j.Success&&(N({message:"删除成功"}),L()),!0)})})(e.row.id)},{default:le((()=>[ce])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"]),t(d(U),{onCurrentChange:O,"hide-on-single-page":"","page-size":d(z),total:null==(f=K.value)?void 0:f.total},null,8,["page-size","total"]),t(F,{ref:v,width:"80%"},{default:le((()=>[p.value?(b(),o(k,{key:0},[ve,t(ae,{onFinish:Y,id:p.value,"course-id":i.value},null,8,["id","course-id"])],64)):q((b(),o("div",pe,null,512)),[[g,!0]])])),_:1},512)])],64)}}});fe.__scopeId="data-v-706be548";var be=e({expose:[],setup:e=>(e,a)=>(b(),o("div",null,[t(fe)]))});be.__scopeId="data-v-5139fb7a";export default be;
