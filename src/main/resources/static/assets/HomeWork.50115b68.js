import{aa as e,d as a,o as s,c as l,Q as i,r as t,F as o,Y as r,H as u,a7 as n,y as d,u as c,a as f,C as v,a4 as p,a5 as m,k,a6 as g,aj as y,j as w,w as I,p as _,e as h,b as x,ak as S,al as C,B as b,am as N,t as F,a9 as P,an as q,ao as O,ap as T,aq as j,ar as z,ah as L,q as B}from"./index.ea109c08.js";import{a as V,_ as W}from"./Fatal.3d90e53b.js";var H=a({expose:[],props:{type:{type:[String,String,String,String],required:!1}},setup:e=>(a,t)=>(s(),l("span",{class:["tag",e.type||"normal"]},[i(a.$slots,"default",{},void 0,!0)],2))});H.__scopeId="data-v-1cdfb8c9";const M=I();_("data-v-4c16f4c2");const Q={class:"detail"},Y={class:"title"},$=f("p",{class:"task-name"},"作业文件",-1),A={class:"flex ac list"},D=f("div",{class:"el-icon-download"},null,-1),E={class:"task-name"},G=k(" 提交记录 "),J={key:0},K=f("span",{style:{"font-size":"14px"}},"无记录",-1),R={class:"flex ac list"},U={class:"file flex ac"},X={class:"file-item"},Z={class:"file-desc"},ee={class:"progress-wrap"},ae=k("新提交");h();var se=a({expose:[],props:{userId:{type:String,required:!0},courseId:{type:Number,required:!0},info:{type:Object,required:!1}},setup(a){const i=a,I=t(null),_=t(o.Normal),h=async()=>{if(P.value=[],_.value=o.Pending,!i.info)return;const a=await(s=i.userId,l=i.info.id,e.get("/work/queryOneWork",{params:{userId:s,taskId:l}}));var s,l;if(a.error_code!==x.Success)return I.value=null,void(_.value=o.Fail);_.value=o.Success,I.value=a.data},F=a=>{a&&I.value&&S.confirm("删除不可逆，确认删除吗?",{cancelButtonText:"取消",confirmButtonText:"确定",async callback(s){if("confirm"===s){_.value=o.Pending;(await((a,s)=>e.post("/work/deleteWork",{userId:a,id:s}))(i.userId,a)).error_code===x.Success?(I.value=null,h(),_.value=o.Success):_.value=o.Fail}}})},P=t([]),q=r((e=>{if(-1!==P.value.findIndex((a=>a.file.name===e.name&&a.file.size===e.size)))return[!1,"不能重复文件"];const a=e.size<15728640;return a&&P.value.push({file:e,progress:0}),[a,"作业不超过15M"]})),O=async()=>{if(!P.value.length)return void b({message:"亲太心急了，等几秒后点击"});if(!i.info)return void b({message:"亲太心急了，等几秒后点击"});let a=null;if(!I.value&&(a=await(s=i.info.id,l=i.courseId,t=i.userId,e.post("/work/addWork",{taskId:s,courseId:l,userId:t})),a.error_code!==x.Success))return;var s,l,t;const o=P.value.map((e=>N(a&&a.data.toString()||I.value.id,e.file,(a=>{e.progress=a.loaded/a.total})).then((e=>{if(e.error_code!==x.Success)throw e;return e}))));try{await Promise.all(o),h()}catch(r){}};return u((()=>{h()})),(e,t)=>{var r,u;const b=n("loading");return d((s(),l("div",Q,[f("h4",Y,v(a.info&&a.info.taskName||""),1),$,f("ul",A,[(s(!0),l(p,null,m(a.info&&a.info.taskFileVOList||[],((e,a)=>(s(),l("li",{class:"p file",key:a},[f("a",{class:"file-item",target:"_blank",href:e.filePath,download:e.fileName},[k(v(e.fileName)+" ",1),D],8,["href","download"])])))),128))]),f("p",E,[G,I.value?(s(),l("i",{key:0,class:"del-btn el-icon-close",onClick:t[1]||(t[1]=e=>{var a;return F((null==(a=I.value)?void 0:a.id)||null)})})):g("",!0)]),I.value?g("",!0):(s(),l("div",J,[K])),f("ul",R,[(s(!0),l(p,null,m((null==(r=I.value)?void 0:r.workFileVOList)||[],(e=>(s(),l("li",U,[f("div",X,[f("a",{href:e.filePath,download:e.fileName},v(e.fileName),9,["href","download"])]),f("i",{class:"del-btn el-icon-close",onClick:a=>(async e=>{e&&S.confirm("删除不可逆，确认删除吗?",{cancelButtonText:"取消",confirmButtonText:"确定",async callback(a){if("confirm"===a&&(await C(e.toString(),i.userId)).error_code===x.Success){const a=I.value.workFileVOList.findIndex((a=>a.id===e));I.value.workFileVOList.splice(a,1),h()}}})})(null==e?void 0:e.id)},null,8,["onClick"])])))),256))]),f("div",null,[f("div",{ref:q,class:"drop-file p"},"选择文件",512),f("ul",Z,[(s(!0),l(p,null,m(P.value,(e=>(s(),l("li",null,[k(v(e.file.name)+" "+v(c(y)(e.file.size))+" ",1),f("div",ee,[f("div",{class:"progress-bar",style:{width:100*e.progress+"%"}},null,4)])])))),256))]),f(c(w),{type:"broke",onClick:O,disabled:!!(null==(u=a.info)?void 0:u.isClosed)},{default:M((()=>[ae])),_:1},8,["disabled"])])],512)),[[b,!a.info||!a.courseId||!a.userId||_.value===c(o).Pending]])}}});se.__scopeId="data-v-4c16f4c2";const le=I();_("data-v-10d9cea4");const ie={class:"view-main"},te={class:"wrap"},oe={class:"info flex jc ac"},re={key:0,class:"list shade"},ue={class:"time",style:{"margin-left":"5px"}},ne={class:"collapse"},de=f("p",null,"作业详情",-1),ce={class:"flex ac homework-list"},fe=f("div",{class:"el-icon-download"},null,-1),ve=k("提交");h();var pe=a({expose:[],setup(a){const i=F(),r=t([]);u((()=>{r.value=i.state.user.allCourses.map((e=>({k:e.courseName,v:e.courseId})))}));const n=t(-1),d=t(""),y=t([]),I=t(0),_=t(o.Normal),h=async()=>{if(n.value<0)return;_.value=o.Pending;const a=await(s=n.value,e.get("/task/queryTasks",{params:{courseId:s}}));var s;a.error_code===x.Success?(y.value=a.data.taskPOList,I.value=a.data.total,_.value=o.Success):_.value=o.Fail};u((()=>{h()}));const S=(e,a)=>{n.value=e,d.value=a},C=t(null),N=t();return(e,a)=>(s(),l("div",ie,[f("div",te,[f("div",oe,[f(P,{class:"logo",courseName:d.value},null,8,["courseName"])]),f(c(q),{class:"shade",items:r.value,onChange:S},null,8,["items"]),y.value.length?(s(),l("div",re,[f(c(O),{accordion:""},{default:le((()=>[(s(!0),l(p,null,m(y.value,(e=>(s(),l(c(T),{key:e.id,class:["item",{done:e.isClosed}]},{title:le((()=>[f(c(j),{class:"header"},{default:le((()=>[f(c(z),{span:12},{default:le((()=>[k(v(e.taskName),1)])),_:2},1024),f(c(z),{span:4},{default:le((()=>[f(H,{style:{"font-size":"12px"},type:e.isClosed?"error":"normal"},{default:le((()=>[k(v(e.isClosed?"已结束":"进行中"),1)])),_:2},1032,["type"])])),_:2},1024),f(c(z),{span:8},{default:le((()=>[f("span",ue,v(c(L)(e.addTime))+"发布, 截至时间"+v(e.closeTime),1)])),_:2},1024)])),_:2},1024)])),default:le((()=>[f("div",ne,[de,f("ul",ce,[(s(!0),l(p,null,m(e.taskFileVOList,((e,a)=>(s(),l("li",{class:"p file",key:a},[f("a",{href:e.filePath,download:e.fileName,target:"_blank"},[k(v(e.fileName)+" ",1),fe],8,["href","download"])])))),128))]),f(c(w),{onClick:a=>(e=>{var a;e.isClosed?b({message:"作业提交通道已关闭，下一次加油叭"}):i.state.user.allCourses[0]?(C.value=e,n.value=-1===n.value?i.state.user.allCourses[0].id:n.value,null==(a=N.value)||a.open()):b({message:"请重新登陆"})})(e)},{default:le((()=>[ve])),_:2},1032,["onClick"])])])),_:2},1032,["class"])))),128))])),_:1})])):_.value===c(o).Success?(s(),l(V,{key:1})):_.value===c(o).Fail?(s(),l(W,{key:2})):g("",!0),f(B,{ref:N,width:"80%"},{default:le((()=>[f(se,{userId:c(i).state.user.userInfo.userId||"",info:C.value||void 0,courseId:n.value},null,8,["userId","info","courseId"])])),_:1},512)])]))}});pe.__scopeId="data-v-10d9cea4";export default pe;
