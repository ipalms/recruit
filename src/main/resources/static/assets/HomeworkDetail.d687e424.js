import{au as e,f as a,ar as l,B as t,d as o,a2 as s,a3 as n,aE as r,aF as i,a0 as c,U as d,aG as u,r as m,o as f,K as p,j as h,e as g,g as w,l as y,F as k,q as b,k as C,s as F}from"./vendor.b6c71576.js";import{a3 as v,a4 as P,a5 as x,k as B,a6 as T,u as _,a7 as E,a8 as N,P as L,a9 as S}from"./index.0564e520.js";import{_ as H}from"./AdBeacon.5756ddb6.js";import{i as I}from"./index.1c41e40c.js";var M=o({components:{ElTable:s,ElTableColumn:n,ElForm:r,ElFormItem:i,ElPagination:c,ElButton:d,AdBeacon:H,ElTag:u},setup(){const o=l(),s=_(),n=m([]),r=m(),i=o.params.id,c=B.get("adminId"),d=m(""),u=m(2),{handleMarkScore:p}=function(){async function l(e,a){return await v(e,a)}return{handleMarkScore:function(t,o){e.prompt("请输入分数","",{confirmButtonText:"确定",cancelButtonText:"取消",inputPlaceholder:"分数为1-10之间的数字",inputPattern:/^(10|[1-9])$/,inputErrorMessage:"分数格式不正确"}).then((async({value:e})=>{const s=Number.parseInt(e),n=await l(t,s);console.log(n),200===n.error_code?(o.score=s,a({type:"success",message:"打分成功！"})):a({type:"error",message:"网络错误！"})}))},handleMarkScoreConfirm:l}}(),{comPersonList:h,handlePaginationChange:g}=function(e){const a=l().params.id;function o(e){return t((()=>(e.data.items.forEach((e=>{e.userName=e.userVO.userName})),e.data.items))).value}return{comPersonList:o,handlePaginationChange:async function(l){const t=await P(a,l,5);console.log(t),e.value=o(t)}}}(r);return f((async()=>{const e=await P(i,1,5);u.value=t((()=>e.data.total)).value,r.value=h(e),n.value=s.state.homework.currentFiles,async function(e){const a=await x(e),l=document.getElementById("diagram"),t=I(l),o={title:{text:"提交情况",subtext:"该作业的提交百分比",left:"center"},tooltip:{trigger:"item"},legend:{orient:"vertical",left:"left"},series:[{type:"pie",radius:"50%",data:[{value:a.data.submitPeople,name:"已提交"},{value:a.data.unSubmitPeople,name:"未提交"}],emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]};o&&t.setOption(o)}(i);const a=await T(i);d.value=a.data,console.log(u)})),{homeworkFileList:n,personList:r,total:u,handlePaginationChange:g,handleMarkScore:p,downloadFileUrl:d,handleCloseHomework:function(){e.confirm("此操作将关闭此作业的提交通道, 是否继续?","",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{const e=await E({id:i,adminId:c});console.log(e),200===e.error_code?a({type:"success",message:"关闭成功！"}):a({type:"error",message:"网络错误！"})})).catch((()=>{a({type:"warning",message:"取消关闭"})}))},handleUploadHomeworkFiles:async function(e){const l=await N(i,e.target.files[0]);if(console.log(l),200===l.error_code){const l=e.target.files[0].name;s.commit({type:`${L.uploadFile}`,payload:{fileName:l,addTime:new Date,filePath:""}}),a({type:"success",message:"附件上传成功！"})}else a({type:"error",message:"上传失败！"})},handleDeleteTaskFile:async function(l,t){e.confirm("此操作将删除这个附件, 是否继续?","",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{const e=await S(t,c);console.log(e),200==e.error_code?(s.commit({type:`${L.deleteFile}`,payload:l}),a({type:"success",message:"删除成功！"})):a({type:"error",message:"网咯错误！"})})).catch((e=>{a({type:"warning",message:e})}))}}}});const U={class:"homework-detail"},j=w("li",{class:"title"},"作业提交详情",-1),O={class:"table"},A=F("打分"),D=w("li",{id:"diagram"},null,-1),$={class:"upload-homework-file"},z=F("上传附件 "),V={class:"files"},q=w("li",{class:"file-title"},"任务附件 :",-1),G={class:"download-file"},K=w("li",{class:"download-homework"},"作业 :",-1);M.render=function(e,a,l,t,o,s){const n=p("AdBeacon"),r=p("router-link"),i=p("el-form-item"),c=p("el-form"),d=p("el-table-column"),u=p("ElButton"),m=p("el-table"),f=p("el-pagination"),F=p("el-tag");return h(),g("ul",U,[w(r,{to:"/checkTask"},{default:y((()=>[w(n,{title:"作业管理",top:-4.5},null,8,["top"])])),_:1}),j,w("li",O,[w(m,{data:e.personList,style:{width:"100%",margin:"0 auto"}},{default:y((()=>[w(d,{type:"expand"},{default:y((e=>[w(c,{"label-position":"left",inline:"",class:"demo-table-expand"},{default:y((()=>[w(i,{class:"homework-file-warp",label:"附件"},{default:y((()=>[(h(!0),g(k,null,b(e.row.workFileVOList,(e=>(h(),g("span",{class:"homework-file",key:e.filePath},[w("a",{style:{color:"#24acf2"},href:e.filePath},C(e.fileName),9,["href"])])))),128))])),_:2},1024)])),_:2},1024)])),_:1}),w(d,{label:"姓名",prop:"userName"}),w(d,{label:"学号",prop:"userId"}),w(d,{label:"分数",prop:"score"}),w(d,{label:"操作",prop:"desc"},{default:y((a=>[w(u,{size:"mini",round:"",onClick:l=>e.handleMarkScore(a.row.id,a.row)},{default:y((()=>[A])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"]),w(f,{onCurrentChange:e.handlePaginationChange,class:"pagination-style",layout:"prev, pager, next",total:e.total,"page-size":"5"},null,8,["onCurrentChange","total"])]),D,w("div",{onClick:a[1]||(a[1]=(...a)=>e.handleCloseHomework&&e.handleCloseHomework(...a)),class:"close-homework"},"关闭"),w("div",$,[w("input",{type:"file",onChange:a[2]||(a[2]=(...a)=>e.handleUploadHomeworkFiles&&e.handleUploadHomeworkFiles(...a))},null,32),z]),w("li",null,[w("ul",V,[q,(h(!0),g(k,null,b(e.homeworkFileList,(a=>(h(),g("li",{class:"file-name",key:a.fileName},[w(F,{onClose:l=>e.handleDeleteTaskFile(a.fileName,a.id),key:a.fileName,closable:""},{default:y((()=>[w("a",{class:"file-a",href:a.filePath},C(a.fileName),9,["href"])])),_:2},1032,["onClose"])])))),128))])]),w("ul",G,[K,w("a",{class:"download-file-start",href:e.downloadFileUrl},"点击下载所有作业",8,["href"])])])};export default M;
